# 1644 通用战争脚本效果
# 让附属国加入宗主的战争

# 通用：让附属国加入宗主的所有战争
# 使用方法：在附属国成为附庸后调用
# 例如：ROOT = { subject_join_overlord_wars = yes }
subject_join_overlord_wars = {
	overlord ?= {
		# 保存宗主为作用域
		save_scope_as = subject_overlord
		
		# 遍历宗主的所有当前战争
		every_current_war = {
			save_scope_as = overlord_war
			
			if = {
				limit = {
					attacker_leader = scope:subject_overlord
					# 确保附属国还没有加入这场战争
					NOT = {
						any_attacker = { this = ROOT }
						any_defender = { this = ROOT }
					}
				}
				ROOT = {
					join_war_as_attacker = { war = scope:overlord_war }
				}
			}
			else_if = {
				limit = {
					defender_leader = scope:subject_overlord
					# 确保附属国还没有加入这场战争
					NOT = {
						any_attacker = { this = ROOT }
						any_defender = { this = ROOT }
					}
				}
				ROOT = {
					join_war_as_defender = { war = scope:overlord_war }
				}
			}
		}
	}
}

# 通用：让附属国加入宗主的特定战争（按敌方国家过滤）
# 使用方法：在附属国成为附庸后调用，可指定敌方国家
# 例如：ROOT = { subject_join_overlord_wars_against_csh_mng = yes }
subject_join_overlord_wars_against_csh_mng = {
	overlord ?= {
		# 保存宗主为作用域
		save_scope_as = subject_overlord
		
		# 遍历宗主的所有当前战争
		every_current_war = {
			save_scope_as = overlord_war
			
			if = {
				limit = {
					attacker_leader = scope:subject_overlord
					# 检查是否有CSH或MNG在防守方
					any_defender = {
						OR = {
							this = c:CSH
							this = c:MNG
						}
					}
					# 确保附属国还没有加入这场战争
					NOT = {
						any_attacker = { this = ROOT }
						any_defender = { this = ROOT }
					}
				}
				ROOT = {
					join_war_as_attacker = { war = scope:overlord_war }
				}
			}
			else_if = {
				limit = {
					defender_leader = scope:subject_overlord
					# 检查是否有CSH或MNG在攻击方
					any_attacker = {
						OR = {
							this = c:CSH
							this = c:MNG
						}
					}
					# 确保附属国还没有加入这场战争
					NOT = {
						any_attacker = { this = ROOT }
						any_defender = { this = ROOT }
					}
				}
				ROOT = {
					join_war_as_defender = { war = scope:overlord_war }
				}
			}
		}
	}
}
